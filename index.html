<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Leap Goals</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="wrap">
    <header class="page-header">
      <h1>Leap Goals</h1>
      <div class="actions">
        <button id="exportBtn" title="Download your goals as JSON">Export</button>
        <label class="import">
          <input id="importInput" type="file" accept="application/json" hidden />
          <span>Import</span>
        </label>
        <button id="clearAllBtn" class="danger" title="Remove everything">Clear All</button>
      </div>
    </header>

    <section class="card">
      <h3>New Leap Goal</h3>
      <form id="newLeapForm" class="row">
        <input id="newLeapTitle" type="text" placeholder="Leap title (e.g., Launch my website)" required />
        <button type="submit">Add Leap</button>
      </form>
    </section>

    <section id="leaps" class="stack"></section>

    <footer class="footer">
      <small>Data is saved locally in your browser.</small>
    </footer>
  </div>

  <script>
  const STORAGE_KEY = 'leapGoalsV1';

  // Load & Save
  function load(){
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
    catch { return []; }
  }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(leaps)); }

  // Utils
  const esc = s => String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  const uid = (p='id') => p + '_' + Math.random().toString(36).slice(2,9);

  // State
  let leaps = load();
  const leapsRoot = document.getElementById('leaps');

  // Render
  function render(){
    leapsRoot.innerHTML = '';
    if (!leaps.length){
      const empty = document.createElement('div');
      empty.className = 'card';
      empty.innerHTML = '<p style="color:var(--muted);margin:0">No leaps yet. Create your first one above.</p>';
      leapsRoot.appendChild(empty);
      return;
    }

    for (const leap of leaps){
      const el = document.createElement('section');
      el.className = 'leap';
      el.dataset.id = leap.id;

      el.innerHTML = `
        <div class="leap-head">
          <div class="leap-title">
            <span class="label">Leap Goal:</span>
            <input type="text" class="leap-input" value="${esc(leap.title)}" />
          </div>
          <div class="leap-ctl">
            <button class="icon-btn danger delete-leap-btn" title="Delete leap">ðŸ—‘</button>
          </div>
        </div>

        <section class="card new-step-card">
          <h4>New Step Goal</h4>
          <form class="add-step-form row">
            <input type="text" class="new-step-text" placeholder="Step title (e.g., Write outline)" required />
            <button type="submit">Add Step</button>
          </form>
        </section>

        <div class="steps">
          ${leap.steps.map(s => `
            <div class="step" data-step="${s.id}">
              <input type="checkbox" class="step-done" ${s.done ? 'checked' : ''} />
              <input type="text" class="step-text" value="${esc(s.text)}" />
              <button class="icon-btn rm step-remove" title="Remove">âœ–</button>
            </div>
          `).join('')}
        </div>
      `;

      leapsRoot.appendChild(el);
    }
  }

  // Create Leap
  document.getElementById('newLeapForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const input = document.getElementById('newLeapTitle');
    const title = input.value.trim();
    if (!title) return input.focus();
    leaps.push({ id: uid('l'), title, steps: [] });
    save(); input.value = ''; render();
  });

  // Submit new Step (per-leap form)
  document.addEventListener('submit', (e)=>{
    if (!e.target.classList.contains('add-step-form')) return;
    e.preventDefault();
    const host = e.target.closest('.leap');
    if (!host) return;
    const leapId = host.dataset.id;
    const leap = leaps.find(l => l.id === leapId);
    if (!leap) return;

    const inp = e.target.querySelector('.new-step-text');
    const text = (inp.value || '').trim();
    if (!text) return inp.focus();

    leap.steps.push({ id: uid('s'), text, done: false });
    save();
    inp.value = '';
    render();
  });

  // Click handlers (remove step, delete leap)
  document.addEventListener('click', (e)=>{
    const host = e.target.closest('.leap');
    if (!host) return;

    const leapId = host.dataset.id;
    const leap = leaps.find(l => l.id === leapId);
    if (!leap) return;

    if (e.target.classList.contains('step-remove')){
      const stepId = e.target.closest('.step').dataset.step;
      leap.steps = leap.steps.filter(s => s.id !== stepId);
      save(); render();
    }

    if (e.target.classList.contains('delete-leap-btn')){
      if (confirm('Delete this leap and all its steps?')){
        leaps = leaps.filter(l => l.id !== leapId);
        save(); render();
      }
    }
  });

  // Input / change handlers (edit title/text, toggle done)
  document.addEventListener('input', (e)=>{
    const host = e.target.closest('.leap');
    if (!host) return;
    const leap = leaps.find(l => l.id === host.dataset.id);
    if (!leap) return;

    if (e.target.classList.contains('leap-input')){
      leap.title = e.target.value;
      save(); // smooth typing (no re-render)
    }
    if (e.target.classList.contains('step-text')){
      const stepId = e.target.closest('.step').dataset.step;
      const step = leap.steps.find(s => s.id === stepId);
      if (step){ step.text = e.target.value; save(); }
    }
  });

  document.addEventListener('change', (e)=>{
    if (!e.target.classList.contains('step-done')) return;
    const host = e.target.closest('.leap');
    const leap = leaps.find(l => l.id === host.dataset.id);
    const stepId = e.target.closest('.step').dataset.step;
    const step = leap?.steps.find(s => s.id === stepId);
    if (step){ step.done = e.target.checked; save(); render(); }
  });

  // Export / Import / Clear
  document.getElementById('clearAllBtn').onclick = ()=>{
    if (confirm('Clear all data?')){ leaps = []; save(); render(); }
  };
  document.getElementById('exportBtn').onclick = ()=>{
    const blob = new Blob([JSON.stringify(leaps, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'leap_goals.json';
    a.click();
    setTimeout(()=>URL.revokeObjectURL(a.href), 0);
  };
  document.getElementById('importInput').onchange = async (e)=>{
    const f = e.target.files?.[0]; if (!f) return;
    try{
      const text = await f.text();
      const data = JSON.parse(text);
      if (!Array.isArray(data)) throw new Error('Invalid file');
      leaps = data; save(); render();
    }catch(err){ alert('Import failed: ' + err.message); }
    finally{ e.target.value = ''; }
  };

  // First paint
  render();
  </script>
</body>
</html>
