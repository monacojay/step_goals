<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Goals List</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="wrap">
    <header class="page-header">
      <h1>Goals List</h1>
      <div class="actions no-print">
        <button id="exportBtn" title="Export / Save as PDF">Export</button>
        <button id="clearAllBtn" class="danger" title="Remove everything">Clear All</button>
      </div>
    </header>

    <div id="printMeta" class="print-only"></div>

    <section class="card">
      <h3>New Leap Goal</h3>
      <form id="newLeapForm" class="row">
        <input id="newLeapTitle" type="text" placeholder="Leap title (e.g., Launch my website)" required />
        <button type="submit">Add Leap</button>
      </form>
    </section>

    <section id="leaps" class="stack"></section>

    <footer class="footer no-print">
      <small>Data is saved locally in your browser.</small>
    </footer>
  </div>

  <script>
  const STORAGE_KEY = 'leapGoalsV1';

  function load(){
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
    catch { return []; }
  }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(leaps)); }

  const esc = s => String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  const uid = (p='id') => p + '_' + Math.random().toString(36).slice(2,9);

  let leaps = load();
  const leapsRoot = document.getElementById('leaps');

  function render(){
    leapsRoot.innerHTML = '';
    if (!leaps.length){
      const empty = document.createElement('div');
      empty.className = 'card';
      empty.innerHTML = '<p style="color:var(--muted);margin:0">Create a leap goal, then create supporting step goals for each leap goal.</p>';
      leapsRoot.appendChild(empty);
      return;
    }

    for (const leap of leaps){
      const el = document.createElement('section');
      el.className = 'leap';
      el.dataset.id = leap.id;

      el.innerHTML = `
        <div class="leap-head">
          <div class="leap-title">
            <span class="label">Leap Goal:</span>
            <input type="text" class="leap-input" value="${esc(leap.title)}" />
          </div>
          <div class="leap-ctl no-print">
            <button class="icon-btn danger delete-leap-btn" title="Delete leap">ðŸ—‘</button>
          </div>
        </div>

        <!-- grid body mirrors label/input columns so everything lines up -->
        <div class="leap-body">
          <div class="spacer"></div>

          <h4 class="steps-heading">Steps</h4>

          <div class="steps">
            ${leap.steps.map(s => `
              <div class="step" data-step="${s.id}">
                <input type="checkbox" class="step-done" ${s.done ? 'checked' : ''} />
                <input type="text" class="step-text" value="${esc(s.text)}" />
                <button class="icon-btn rm step-remove no-print" title="Remove">âœ–</button>
              </div>
            `).join('')}
          </div>

          <section class="card new-step-card no-break">
            <h4>New Supporting Step Goal</h4>
            <form class="add-step-form row">
              <input type="text" class="new-step-text" placeholder="Step title (e.g., Write outline)" required />
              <button type="submit">Add Step</button>
            </form>
          </section>
        </div>
      `;

      leapsRoot.appendChild(el);
    }
  }

  // Create Leap
  document.getElementById('newLeapForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const input = document.getElementById('newLeapTitle');
    const title = input.value.trim();
    if (!title) return input.focus();
    leaps.push({ id: uid('l'), title, steps: [] });
    save(); input.value = ''; render();
  });

  // Add Step (per-leap form)
  document.addEventListener('submit', (e)=>{
    if (!e.target.classList.contains('add-step-form')) return;
    e.preventDefault();
    const host = e.target.closest('.leap');
    if (!host) return;
    const leap = leaps.find(l => l.id === host.dataset.id);
    const inp = e.target.querySelector('.new-step-text');
    const text = (inp.value || '').trim();
    if (!text) return inp.focus();
    leap.steps.push({ id: uid('s'), text, done: false });
    save(); inp.value = ''; render();
  });

  // Click handlers (remove step, delete leap)
  document.addEventListener('click', (e)=>{
    const host = e.target.closest('.leap');
    if (!host) return;

    const leapId = host.dataset.id;
    const leap = leaps.find(l => l.id === leapId);
    if (!leap) return;

    if (e.target.classList.contains('step-remove')){
      const stepId = e.target.closest('.step').dataset.step;
      leap.steps = leap.steps.filter(s => s.id !== stepId);
      save(); render();
    }

    if (e.target.classList.contains('delete-leap-btn')){
      if (confirm('Delete this leap and all its steps?')){
        leaps = leaps.filter(l => l.id !== leapId);
        save(); render();
      }
    }
  });

  // Edit / toggle
  document.addEventListener('input', (e)=>{
    const host = e.target.closest('.leap');
    if (!host) return;
    const leap = leaps.find(l => l.id === host.dataset.id);

    if (e.target.classList.contains('leap-input')){
      leap.title = e.target.value; save();
    }
    if (e.target.classList.contains('step-text')){
      const stepId = e.target.closest('.step').dataset.step;
      const step = leap.steps.find(s => s.id === stepId);
      if (step){ step.text = e.target.value; save(); }
    }
  });

  document.addEventListener('change', (e)=>{
    if (!e.target.classList.contains('step-done')) return;
    const host = e.target.closest('.leap');
    const leap = leaps.find(l => l.id === host.dataset.id);
    const stepId = e.target.closest('.step').dataset.step;
    const step = leap?.steps.find(s => s.id === stepId);
    if (step){ step.done = e.target.checked; save(); render(); }
  });

  // Clear all
  document.getElementById('clearAllBtn').onclick = ()=>{
    if (confirm('Clear all data?')){ leaps = []; save(); render(); }
  };

  // Export -> PDF
  document.getElementById('exportBtn').onclick = ()=>{
    document.getElementById('printMeta').textContent = '';
    window.print();
  };

  render();
  </script>
</body>
</html>
